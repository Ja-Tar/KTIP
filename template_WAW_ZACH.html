<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wyświetlacz / Display</title>
    <link rel="stylesheet" href="template_WAW_ZACH.css">
</head>

<body>
    <script>
        window.addEventListener('resize', scaleDisplay);
        document.addEventListener('DOMContentLoaded', function () {
            scaleDisplay();
            replaceTemplateValues();
            scrollText();
        });

        function scaleDisplay() {
            var display = document.getElementById('display');
            var scaleFactor = window.innerWidth / 700;

            display.style.transform = 'scale(' + scaleFactor + ')';
            display.style.transformOrigin = 'top left';
        }

        function replaceTemplateValues() {
            var time = document.getElementById('time');
            var trainNumber = document.getElementById('train_number');
            var destination = document.getElementById('destination');
            var viaStations = document.getElementById('via_stations');
            var operator = document.getElementById('operator');
            var infoBar = document.getElementById('info_bar');

            var urlParams = new URLSearchParams(window.location.search);

            if (!urlParams.has('time') || !urlParams.has('train_number') || !urlParams.has('destination') || !urlParams.has('via_stations') || !urlParams.has('operator') || !urlParams.has('info_bar')) {
                return;
            }

            time.innerHTML = urlParams.get('time');
            trainNumber.innerHTML = urlParams.get('train_number');
            destination.innerHTML = urlParams.get('destination');
            destination.setAttribute('data-scroll-text', urlParams.get('destination'));
            viaStations.innerHTML = urlParams.get('via_stations');
            viaStations.setAttribute('data-scroll-text', urlParams.get('via_stations'));
            operator.innerHTML = urlParams.get('operator');

            if (urlParams.has('info_bar') && urlParams.get('info_bar') != '') { 
                infoBar.innerHTML = urlParams.get('info_bar');
                infoBar.setAttribute('data-scroll-text', urlParams.get('info_bar'));
            } else {
                infoBar.parentElement.style.display = "none"
            }
        }

        function scrollText() {
            var scrollElements = document.getElementsByClassName('scroll');
            for (var i = 0; i < scrollElements.length; i++) {
                var scrollElement = scrollElements[i];
                var scrollText = scrollElement.getAttribute('data-scroll-text');
                let scroll_animation_duration;
                if (scrollElement.id == 'via_stations') {
                    if (scrollText.length >= 42) {
                        scrollElement.setAttribute("class", 'scrolling');
                        continue;
                    } 
                    scroll_animation_duration = scrollText.length / 3.8;
                } else if (scrollElement.id == 'info_bar') {
                    scroll_animation_duration = scrollText.length / 3.1;
                    if (scrollText.length >= 47) {
                        scrollElement.setAttribute("class", 'scrolling');
                        continue;
                    } 
                } else {
                    if (scrollText.length >= 18) {
                        scrollElement.setAttribute("class", 'scrolling');
                        continue;
                    } 
                    scroll_animation_duration = scrollText.length;
                }
                scrollElement.innerHTML = scrollText;
                scrollElement.style.setProperty('--scroll-animation-duration', scroll_animation_duration + 's');
                scrollElement.style.setProperty('--scroll-animation-delay', (scroll_animation_duration / 2) + 's');
            }
        }
    </script>
    <div id="display_box">
        <li id="display">
            <ul id="row1" class="row">
                <div id="time">00:00</div>
                <div id="delay_box" style="display: none;">
                    <div class="label">Opóźniony / Delayed:</div>
                    <div id="delay"></div> <!-- TODO -->
                </div>
                <div id="train_number_box">
                    <div class="label">Numer / Number:</div>
                    <div id="train_number">{TRAIN_NUMBER}</div>
                </div>
            </ul>
            <ul id="row2" class="row">
                <div id="destination" class="scroll">{DESTINATION}</div>
            </ul>
            <ul id="row3" class="row">
                <div id="via_stations_box">
                    <div class="label">Stacje pośrednie / Via stations:</div>
                    <div id="via_stations" class="scroll">{VIA_STATIONS}</div>
                </div>
            </ul>
            <ul id="row4" class="row">
                <div id="operator_box">
                    <div class="label">Przewoźnik / Operator:</div>
                    <div id="operator">{OPERATOR}</div>
                </div>
            </ul>
            <ul id="info_bar_box" class="row">
                <div id="info_bar" class="scroll">{INFO_BAR}</div>
            </ul>
        </li>
    </div>
    <!-- The ids are used for replacing the template value -->
</body>

</html>